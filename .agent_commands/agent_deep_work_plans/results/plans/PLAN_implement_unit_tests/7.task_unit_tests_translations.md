# Task 7: Write Unit Tests for translations/

## 1. Context

**Purpose:** Create unit tests for the translation system, focusing on structural completeness and the `getTranslations` API.

**Where:**
- `tests/unit/lib/translations.test.ts` — New test file
- `src/lib/translations/index.ts` — Main API (`getTranslations`, re-exports)
- `src/lib/translations/en.ts` — English translations
- `src/lib/translations/es.ts` — Spanish translations
- `src/lib/translations/types.ts` — `SiteTranslations` interface

**Exports from `src/lib/translations/index.ts`:**

| Export | Type | Purpose |
|--------|------|---------|
| `getTranslations(lang)` | Function | Returns `SiteTranslations` object for given language |
| `isValidLanguage` | Re-export from `../i18n` | Type guard for valid languages |
| `getDefaultLanguage` | Re-export from `../i18n` | Returns `'en'` |
| Type exports | Types | `Language`, `SiteTranslations`, etc. |

**Translation objects (`en.ts`, `es.ts`):**
- Large nested objects implementing `SiteTranslations` interface
- Top-level sections include: `nav`, `blog`, `common`, `footer`, `home`, `about`, `contact`, pages, etc.
- Both must have **identical key structures** (same nested keys, different string values)

**Dependencies:** Tasks 1-3 must be completed.

## 2. Read Before Starting

- Task 5 Completion & Log: i18n tests may have already tested `isValidLanguage` and `getDefaultLanguage`

## 3. Goal

Write unit tests that verify: (1) `getTranslations` returns valid, complete translation objects for all languages, (2) both language files have identical key structures (no missing translations), (3) no empty string values in translations. This is primarily a **structural validation** task.

## 4. Instructions

> **Before starting:** Re-read the plan README section 1 (Goal) to ensure this task's work aligns with the overall objective.

### Step 1: Read the source files

Read these files:
- `src/lib/translations/index.ts` — Understand how `getTranslations` works
- `src/lib/translations/types.ts` — Understand the `SiteTranslations` interface
- `src/lib/translations/en.ts` — Skim to understand the structure (it's large)
- `src/lib/translations/es.ts` — Same structure

### Step 2: Create helper function for deep key extraction

Create a utility function (inside the test file or fixtures) that recursively extracts all keys from a nested object:

```typescript
function getDeepKeys(obj: Record<string, unknown>, prefix = ''): string[] {
  return Object.entries(obj).flatMap(([key, value]) => {
    const fullKey = prefix ? `${prefix}.${key}` : key;
    if (value && typeof value === 'object' && !Array.isArray(value)) {
      return getDeepKeys(value as Record<string, unknown>, fullKey);
    }
    return [fullKey];
  });
}
```

### Step 3: Create `tests/unit/lib/translations.test.ts`

Write tests:

#### `getTranslations`
- Returns a non-null object for `'en'`
- Returns a non-null object for `'es'`
- Returned objects have expected top-level keys (`nav`, `blog`, `common`, `footer`, etc.)
- Returns different objects for different languages (values differ)

#### Structural completeness
- English and Spanish translations have identical deep key structures
- Find any keys in `en` that are missing from `es` → should be empty
- Find any keys in `es` that are missing from `en` → should be empty
- Both languages have the same number of leaf keys

#### Value quality
- No empty string values (`''`) in English translations
- No empty string values (`''`) in Spanish translations
- All leaf values are strings (not undefined or null)

#### Re-exports
- `isValidLanguage` is re-exported and works (tested more thoroughly in i18n.test.ts)
- `getDefaultLanguage` is re-exported and returns `'en'`

### Step 4: Run tests

```bash
npm run test
```

## 5. Acceptance Criteria

- [ ] `tests/unit/lib/translations.test.ts` exists
- [ ] `getTranslations` tested for all languages
- [ ] Structural completeness validated (identical key structures)
- [ ] No empty string values in translations
- [ ] Re-exports verified
- [ ] All tests pass (`npm run test`)

## 6. Outputs

- `tests/unit/lib/translations.test.ts` — Complete test file for translation system

## 7. Validation

```bash
# Run tests
npm run test

# Verify biome compliance
npm run biome:check
```

## 8. Execution Checklist

- [ ] Read translation source files
- [ ] Create deep key extraction helper
- [ ] Create `tests/unit/lib/translations.test.ts`
- [ ] Write structural completeness tests
- [ ] Write value quality tests
- [ ] Run `npm run test` — all pass
- [ ] Run `npm run biome:check`
- [ ] Update plan README `[ ] → [x]`
- [ ] Update PROGRESS.md
- [ ] Commit changes
- [ ] Update log below

## 9. Completion & Log

**Status:** Completed

- Tests written: 14
- Tests passing: 14/14
- Key count (en/es): Identical count, both > 50 keys
- Missing keys found: None (perfect parity)
- Notes: Fixed initial test that assumed a "blog" top-level key; actual structure uses flat top-level keys like searchPlaceholder, previous, etc.
