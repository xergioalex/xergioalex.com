# API Reference

API endpoints and data formats for XergioAleX.com.

## Overview

XergioAleX.com is primarily a static site, but includes a few API endpoints and data feeds:

| Endpoint | Type | Purpose |
|----------|------|---------|
| `/api/posts.json` | JSON API | Blog search index |
| `/rss.xml` | RSS Feed | Blog subscription |
| `/sitemap-index.xml` | Sitemap | Search engine indexing |

## API Endpoints

### GET /api/posts.json

Returns a JSON array of all blog posts for client-side search.

**Location:** `src/pages/api/posts.json.ts`

#### Response

```typescript
interface PostIndexEntry {
  id: string;           // Post ID (used in URLs)
  slug: string;         // Same as id
  title: string;        // Post title
  description: string;  // Post description
  pubDate: string;      // ISO 8601 date string
  tags: string[];       // Array of tag names
  heroImage?: string;   // Optional hero image path
}

type Response = PostIndexEntry[];
```

#### Example Response

```json
[
  {
    "id": "first-post",
    "slug": "first-post",
    "title": "My First Blog Post",
    "description": "This is my first blog post about web development.",
    "pubDate": "2024-01-15T00:00:00.000Z",
    "tags": ["tech", "tutorial"],
    "heroImage": "/images/first-post-hero.jpg"
  },
  {
    "id": "using-mdx",
    "slug": "using-mdx",
    "title": "Using MDX in Astro",
    "description": "Learn how to use MDX for enhanced blog posts.",
    "pubDate": "2024-01-20T00:00:00.000Z",
    "tags": ["tech"],
    "heroImage": null
  }
]
```

#### Headers

```
Content-Type: application/json
Cache-Control: public, max-age=3600
```

#### Error Response

```json
{
  "error": "Internal server error"
}
```

Status: `500`

#### Usage Example

```typescript
// Client-side search
async function searchPosts(query: string) {
  const response = await fetch('/api/posts.json');
  const posts = await response.json();
  
  return posts.filter(post => 
    post.title.toLowerCase().includes(query.toLowerCase()) ||
    post.description.toLowerCase().includes(query.toLowerCase()) ||
    post.tags.some(tag => tag.toLowerCase().includes(query.toLowerCase()))
  );
}
```

## Data Feeds

### RSS Feed

**Location:** `/rss.xml` (generated by `src/pages/rss.xml.js`)

Standard RSS 2.0 feed for blog subscriptions.

#### Feed Structure

```xml
<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0">
  <channel>
    <title>XergioAleX Blog</title>
    <link>https://xergioalex.com</link>
    <description>Blog posts from XergioAleX</description>
    <item>
      <title>Post Title</title>
      <link>https://xergioalex.com/blog/post-slug/</link>
      <description>Post description</description>
      <pubDate>Mon, 15 Jan 2024 00:00:00 GMT</pubDate>
    </item>
    <!-- More items... -->
  </channel>
</rss>
```

#### Usage

Subscribe with any RSS reader using:

```
https://xergioalex.com/rss.xml
```

### Sitemap

**Location:** `/sitemap-index.xml` (auto-generated by `@astrojs/sitemap`)

XML sitemap for search engine indexing.

#### Configuration

```javascript
// astro.config.mjs
import sitemap from '@astrojs/sitemap';

export default defineConfig({
  site: 'https://xergioalex.com',
  integrations: [sitemap()],
});
```

## Content Collections API

The site uses Astro Content Collections for blog posts and tags.

### Blog Collection Schema

```typescript
// src/content.config.ts
const blog = defineCollection({
  loader: glob({ base: './src/content/blog', pattern: '**/*.{md,mdx}' }),
  schema: z.object({
    title: z.string(),
    description: z.string(),
    pubDate: z.coerce.date(),
    updatedDate: z.coerce.date().optional(),
    heroImage: z.string().optional(),
    tags: z.array(z.string()).optional(),
  }),
});
```

### Tags Collection Schema

```typescript
const tags = defineCollection({
  schema: z.object({
    name: z.string(),
    description: z.string().optional(),
  }),
});
```

### Querying Collections

```typescript
import { getCollection } from 'astro:content';

// Get all posts
const posts = await getCollection('blog');

// Get posts with specific tag
const techPosts = await getCollection('blog', ({ data }) => 
  data.tags?.includes('tech')
);

// Get all tags
const tags = await getCollection('tags');
```

### Collection Entry Type

```typescript
import type { CollectionEntry } from 'astro:content';

type BlogPost = CollectionEntry<'blog'>;

// Access properties
const post: BlogPost = posts[0];
console.log(post.id);           // 'first-post'
console.log(post.data.title);   // 'My First Blog Post'
console.log(post.data.pubDate); // Date object
```

## Creating New API Routes

### Basic Pattern

```typescript
// src/pages/api/example.json.ts
import type { APIRoute } from 'astro';

export const GET: APIRoute = async ({ request, params }) => {
  try {
    const data = await fetchData();
    
    return new Response(JSON.stringify(data), {
      status: 200,
      headers: {
        'Content-Type': 'application/json',
        'Cache-Control': 'public, max-age=3600',
      },
    });
  } catch (error) {
    console.error('API error:', error);
    return new Response(JSON.stringify({ error: 'Server error' }), {
      status: 500,
      headers: { 'Content-Type': 'application/json' },
    });
  }
};
```

### With Parameters

```typescript
// src/pages/api/posts/[slug].json.ts
import type { APIRoute } from 'astro';
import { getCollection } from 'astro:content';

export const GET: APIRoute = async ({ params }) => {
  const { slug } = params;
  const posts = await getCollection('blog');
  const post = posts.find(p => p.id === slug);
  
  if (!post) {
    return new Response(JSON.stringify({ error: 'Not found' }), {
      status: 404,
    });
  }
  
  return new Response(JSON.stringify(post.data), {
    status: 200,
    headers: { 'Content-Type': 'application/json' },
  });
};

export function getStaticPaths() {
  // Required for static generation
  return [
    { params: { slug: 'first-post' } },
    { params: { slug: 'second-post' } },
  ];
}
```

### POST/PUT/DELETE (If Needed)

```typescript
// src/pages/api/contact.json.ts
import type { APIRoute } from 'astro';

export const POST: APIRoute = async ({ request }) => {
  try {
    const body = await request.json();
    
    // Validate input
    if (!body.email || !body.message) {
      return new Response(JSON.stringify({ error: 'Missing fields' }), {
        status: 400,
      });
    }
    
    // Process (e.g., send email, save to service)
    await processContactForm(body);
    
    return new Response(JSON.stringify({ success: true }), {
      status: 200,
    });
  } catch (error) {
    return new Response(JSON.stringify({ error: 'Server error' }), {
      status: 500,
    });
  }
};
```

## Error Handling

### Standard Error Format

```typescript
interface APIError {
  error: string;
  details?: string;
}
```

### HTTP Status Codes

| Code | Meaning | Usage |
|------|---------|-------|
| 200 | OK | Successful request |
| 400 | Bad Request | Invalid input |
| 404 | Not Found | Resource doesn't exist |
| 500 | Server Error | Internal error |

## Caching

### Cache-Control Headers

```typescript
// Long cache for stable content
'Cache-Control': 'public, max-age=86400' // 1 day

// Short cache for dynamic content
'Cache-Control': 'public, max-age=300' // 5 minutes

// No cache for sensitive endpoints
'Cache-Control': 'no-store'
```

## Rate Limiting

GitHub Pages doesn't support rate limiting. If needed, consider:

- Moving to a host with edge functions (Vercel, Netlify)
- Adding a CDN with rate limiting (Cloudflare)

## TypeScript Types

### APIRoute Type

```typescript
import type { APIRoute, APIContext } from 'astro';

// Full context available
export const GET: APIRoute = async (context: APIContext) => {
  const { request, params, cookies, url } = context;
  // ...
};
```

### Response Helpers

```typescript
// JSON response helper
function jsonResponse(data: unknown, status = 200) {
  return new Response(JSON.stringify(data), {
    status,
    headers: { 'Content-Type': 'application/json' },
  });
}

// Error response helper
function errorResponse(message: string, status = 500) {
  return new Response(JSON.stringify({ error: message }), {
    status,
    headers: { 'Content-Type': 'application/json' },
  });
}
```

## Resources

- [Astro API Routes](https://docs.astro.build/en/core-concepts/endpoints/)
- [Astro Content Collections](https://docs.astro.build/en/guides/content-collections/)
- [RSS Package](https://docs.astro.build/en/guides/rss/)
