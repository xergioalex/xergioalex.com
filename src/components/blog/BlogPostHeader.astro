---
import FormattedDate from '@/components/FormattedDate.astro';
import { getUrlPrefix, type Language } from '@/lib/i18n';
import { getTranslations } from '@/lib/translations';

interface Props {
  title: string;
  pubDate: Date;
  updatedDate?: Date;
  heroImage?: string;
  heroLayout?: 'banner' | 'side-by-side' | 'minimal' | 'none';
  tags?: string[];
  lang: Language;
  readingTimeMinutes: number;
}

const {
  title,
  pubDate,
  updatedDate,
  heroImage,
  heroLayout = 'banner',
  tags,
  lang,
  readingTimeMinutes,
} = Astro.props;

const t = getTranslations(lang);
const langPrefix = getUrlPrefix(lang);
---

{/* Banner layout: Full-width image above title (landscape/wide images) */}
{heroLayout === 'banner' && (
  <div>
    {heroImage && (
      <div class="w-full overflow-hidden rounded-xl">
        <img
          width={1020}
          height={510}
          src={heroImage}
          alt={title}
          loading="eager"
          class="block h-auto w-full rounded-xl object-cover shadow-(--box-shadow)"
        />
      </div>
    )}
    <div class="mt-6 text-[rgb(var(--gray-dark))] dark:text-gray-100">
      <div class="mb-6 border-b border-gray-200 py-4 text-center dark:border-gray-700">
        <div class="mb-3 flex flex-wrap items-center justify-center gap-3 text-sm text-[rgb(var(--gray))]">
          <FormattedDate date={pubDate} lang={lang} />
          <span aria-hidden="true">•</span>
          <span>{t.readingTime(readingTimeMinutes)}</span>
          {updatedDate && (
            <div class="italic">
              <span aria-hidden="true">•</span>{' '}
              {t.lastUpdatedOn} <FormattedDate date={updatedDate} lang={lang} />
            </div>
          )}
        </div>
        <h1 class="m-0 mb-3 text-balance text-4xl font-extrabold">{title}</h1>
        {tags && tags.length > 0 && (
          <div class="mb-2 flex flex-wrap justify-center gap-2">
            {tags.map((tag) => (
              <a
                href={`${langPrefix}/blog/tag/${tag}/`}
                class="rounded bg-blue-100 px-3 py-1 text-sm text-blue-800 transition-colors hover:bg-blue-200 dark:bg-blue-900 dark:text-blue-200 dark:hover:bg-blue-800"
              >
                #{t.tagNames[tag] || tag}
              </a>
            ))}
          </div>
        )}
      </div>
    </div>
  </div>
)}

{/* Side-by-side layout: Title left, image right (square images) */}
{heroLayout === 'side-by-side' && (
  <div>
    <div class="mb-6 grid grid-cols-1 items-center gap-8 md:grid-cols-2">
      <div class="text-[rgb(var(--gray-dark))] dark:text-gray-100">
        <div class="mb-3 flex flex-wrap items-center gap-3 text-sm text-[rgb(var(--gray))]">
          <FormattedDate date={pubDate} lang={lang} />
          <span aria-hidden="true">•</span>
          <span>{t.readingTime(readingTimeMinutes)}</span>
          {updatedDate && (
            <div class="italic">
              <span aria-hidden="true">•</span>{' '}
              {t.lastUpdatedOn} <FormattedDate date={updatedDate} lang={lang} />
            </div>
          )}
        </div>
        <h1 class="m-0 mb-4 text-balance text-4xl font-extrabold">{title}</h1>
        {tags && tags.length > 0 && (
          <div class="mb-2 flex flex-wrap gap-2">
            {tags.map((tag) => (
              <a
                href={`${langPrefix}/blog/tag/${tag}/`}
                class="rounded bg-blue-100 px-3 py-1 text-sm text-blue-800 transition-colors hover:bg-blue-200 dark:bg-blue-900 dark:text-blue-200 dark:hover:bg-blue-800"
              >
                #{t.tagNames[tag] || tag}
              </a>
            ))}
          </div>
        )}
      </div>
      {heroImage && (
        <div class="overflow-hidden rounded-xl">
          <img
            src={heroImage}
            alt={title}
            loading="eager"
            class="block h-auto max-h-96 w-full rounded-xl object-cover shadow-(--box-shadow)"
          />
        </div>
      )}
    </div>
    <div class="mb-6 border-b border-gray-200 dark:border-gray-700" />
  </div>
)}

{/* Minimal layout: Small thumbnail with text-focused design */}
{heroLayout === 'minimal' && (
  <div>
    <div class="mb-6 border-b border-gray-200 pb-6 dark:border-gray-700">
      <div class="flex flex-col gap-4 md:flex-row md:items-start md:gap-6">
        {heroImage && (
          <img
            src={heroImage}
            alt={title}
            loading="eager"
            class="h-32 w-32 shrink-0 rounded-lg object-cover shadow-(--box-shadow) md:h-40 md:w-40"
          />
        )}
        <div class="text-[rgb(var(--gray-dark))] dark:text-gray-100">
          <div class="mb-2 flex flex-wrap items-center gap-3 text-sm text-[rgb(var(--gray))]">
            <FormattedDate date={pubDate} lang={lang} />
            <span aria-hidden="true">•</span>
            <span>{t.readingTime(readingTimeMinutes)}</span>
            {updatedDate && (
              <div class="italic">
                <span aria-hidden="true">•</span>{' '}
                {t.lastUpdatedOn} <FormattedDate date={updatedDate} lang={lang} />
              </div>
            )}
          </div>
          <h1 class="m-0 mb-3 text-balance text-4xl font-extrabold">{title}</h1>
          {tags && tags.length > 0 && (
            <div class="mb-2 flex flex-wrap gap-2">
              {tags.map((tag) => (
                <a
                  href={`${langPrefix}/blog/tag/${tag}/`}
                  class="rounded bg-blue-100 px-3 py-1 text-sm text-blue-800 transition-colors hover:bg-blue-200 dark:bg-blue-900 dark:text-blue-200 dark:hover:bg-blue-800"
                >
                  #{t.tagNames[tag] || tag}
                </a>
              ))}
            </div>
          )}
        </div>
      </div>
    </div>
  </div>
)}

{/* None layout: No hero image, just title and metadata */}
{heroLayout === 'none' && (
  <div class="text-[rgb(var(--gray-dark))] dark:text-gray-100">
    <div class="mb-6 border-b border-gray-200 py-4 text-center dark:border-gray-700">
      <div class="mb-3 flex flex-wrap items-center justify-center gap-3 text-sm text-[rgb(var(--gray))]">
        <FormattedDate date={pubDate} lang={lang} />
        <span aria-hidden="true">•</span>
        <span>{t.readingTime(readingTimeMinutes)}</span>
        {updatedDate && (
          <div class="italic">
            <span aria-hidden="true">•</span>{' '}
            {t.lastUpdatedOn} <FormattedDate date={updatedDate} lang={lang} />
          </div>
        )}
      </div>
      <h1 class="m-0 mb-3 text-balance text-4xl font-extrabold">{title}</h1>
      {tags && tags.length > 0 && (
        <div class="mb-2 flex flex-wrap justify-center gap-2">
          {tags.map((tag) => (
            <a
              href={`${langPrefix}/blog/tag/${tag}/`}
              class="rounded bg-blue-100 px-3 py-1 text-sm text-blue-800 transition-colors hover:bg-blue-200 dark:bg-blue-900 dark:text-blue-200 dark:hover:bg-blue-800"
            >
              #{t.tagNames[tag] || tag}
            </a>
          ))}
        </div>
      )}
    </div>
  </div>
)}
