---
import BlogContainer from '@/components/blog/BlogContainer.astro';
import JsonLd from '@/components/JsonLd.astro';
import MainLayout from '@/layouts/MainLayout.astro';
import { getBlogPosts } from '@/lib/blog';
import { getTranslations, type Language } from '@/lib/translations';
import type { BlogPostsResultType } from '@/lib/types';

const lang: Language = 'en';
const t = getTranslations(lang);
const isDev = import.meta.env.DEV;
const previewAll = isDev && Astro.url.searchParams.get('preview') === 'all';

const blogPostsResult: BlogPostsResultType = await getBlogPosts({
  lang: lang,
  includeHidden: previewAll,
});

const collectionPageData = {
  '@context': 'https://schema.org',
  '@type': 'CollectionPage',
  name: t.blogTitle,
  description: t.blogDescription,
  inLanguage: 'en',
  url: new URL('/blog/', Astro.site).href,
};
---

<MainLayout
	lang={lang}
	title={t.blogTitle}
	description={t.blogDescription}
>
	<Fragment slot="head">
		<JsonLd data={collectionPageData} />
	</Fragment>
	<BlogContainer blogPostsResult={blogPostsResult} lang={lang} isPreviewMode={previewAll} isDev={isDev} />
</MainLayout>
