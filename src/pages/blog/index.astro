---
import { getCollection } from "astro:content";
import MainLayout from "@/layouts/MainLayout.astro";
import FormattedDate from "@/components/FormattedDate.astro";

const posts = (await getCollection("blog")).sort(
	(a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf(),
);

const allTags = Array.from(
	new Set(posts.flatMap((post) => post.data.tags ?? [])),
);
---

<MainLayout
	title="Blog"
	description="ArtÃ­culos, tutoriales, journal y charlas."
>
	<h1 class="text-3xl font-bold mb-8">Blog</h1>
	<div class="mb-8 flex flex-wrap gap-2">
		{
			allTags.map((tag) => (
				<a
					href={`/blog/tag/${tag}/`}
					class="text-xs bg-blue-100 text-blue-800 px-2 py-0.5 rounded"
				>
					{tag}
				</a>
			))
		}
	</div>
	<ul class="space-y-6">
		{
			posts.map((post) => (
				<li>
					<a href={`/blog/${post.id}/`} class="block group">
						<h2 class="text-xl font-semibold group-hover:underline">
							{post.data.title}
						</h2>
						<p class="text-gray-500">{post.data.description}</p>
						<span class="text-sm text-gray-400">
							<FormattedDate date={post.data.pubDate} />
						</span>
						<div class="flex gap-2 mt-2">
							{post.data.tags?.map((tag) => (
								<a
									href={`/blog/tag/${tag}/`}
									class="text-xs bg-blue-100 text-blue-800 px-2 py-0.5 rounded"
								>
									{tag}
								</a>
							))}
						</div>
					</a>
				</li>
			))
		}
	</ul>
</MainLayout>
