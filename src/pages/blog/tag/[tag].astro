---
import BlogTagPage from '@/components/pages/blog/BlogTagPage.astro';
import { getBlogPosts } from '@/lib/blog';
import type { Language } from '@/lib/i18n';

const lang: Language = 'en';

export async function getStaticPaths() {
  const lang: Language = 'en';

  // Get all tags from all posts (not just first page)
  const allPosts = await getBlogPosts({ lang, pageSize: 9999 });
  const allTags = Array.from(
    new Set(allPosts.postsResult.flatMap((post) => post.data.tags ?? []))
  );

  const paths = [];
  for (const tag of allTags) {
    const tagPostsResult = await getBlogPosts({
      lang,
      tag,
    });
    paths.push({
      params: { tag },
      props: { blogPostsResult: tagPostsResult, currentTag: tag },
    });
  }
  return paths;
}

const { blogPostsResult, currentTag } = Astro.props;
const { tag } = Astro.params;
---

<BlogTagPage lang={lang} blogPostsResult={blogPostsResult} currentTag={currentTag} tag={tag} />
