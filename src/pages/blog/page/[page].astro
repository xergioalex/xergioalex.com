---
import BlogContainer from '@/components/blog/BlogContainer.astro';
import MainLayout from '@/layouts/MainLayout.astro';
import { getBlogPosts } from '@/lib/blog';
import type { BlogPostsResultType } from '@/lib/types';

const lang: string = 'en';

export async function getStaticPaths() {
  const lang: string = 'en';
  const blogPostsResult: BlogPostsResultType = await getBlogPosts({ lang });
  const totalPages = blogPostsResult.totalPages;

  const paths = [];
  for (let i = 1; i <= totalPages; i++) {
    const pagePosts = await getBlogPosts({ lang, page: i });
    paths.push({
      params: { page: String(i) },
      props: {
        blogPostsResult: pagePosts,
      },
    });
  }
  return paths;
}

const { blogPostsResult } = Astro.props;

const { currentPage, totalPages } = blogPostsResult;
const prevPage =
  currentPage > 1
    ? new URL(`/blog/page/${currentPage - 1}/`, Astro.site).href
    : undefined;
const nextPage =
  currentPage < totalPages
    ? new URL(`/blog/page/${currentPage + 1}/`, Astro.site).href
    : undefined;
---

<MainLayout
  lang={lang}
  title="Blog"
  description="Articles, tutorials, journal and talks."
  prevPage={prevPage}
  nextPage={nextPage}
>
  <BlogContainer blogPostsResult={blogPostsResult} lang={lang} />
</MainLayout>
