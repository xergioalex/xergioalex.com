---
import InternalLayout from '@/layouts/InternalLayout.astro';

const importantFiles = [
  {
    file: 'astro.config.mjs',
    purpose: 'Astro configuration, integrations, sitemap filter',
  },
  {
    file: 'src/content.config.ts',
    purpose: 'Content Collection schemas (blog, tags)',
  },
  {
    file: 'src/styles/global.css',
    purpose: 'Design tokens, custom properties, global styles',
  },
  { file: 'src/lib/i18n.ts', purpose: 'Language configuration, URL helpers' },
  {
    file: 'src/lib/translations/index.ts',
    purpose: 'Translation system public API',
  },
  {
    file: 'src/lib/blog.ts',
    purpose: 'Post fetching, pagination, slug helpers',
  },
  {
    file: 'src/lib/constances.ts',
    purpose: 'Site constants (title, description, URLs)',
  },
  { file: 'biome.json', purpose: 'Biome linter and formatter configuration' },
  {
    file: 'tsconfig.json',
    purpose: 'TypeScript configuration with @ path alias',
  },
  {
    file: 'AGENTS.md',
    purpose: 'Single source of truth for all AI agent instructions',
  },
];

const namingConventions = [
  {
    context: 'Blog posts',
    pattern: 'YYYY-MM-DD_slug.md',
    example: '2024-03-15_my-awesome-post.md',
  },
  {
    context: 'Blog images',
    pattern: '/images/blog/posts/{slug}/hero.jpg',
    example: '/images/blog/posts/my-post/hero.jpg',
  },
  {
    context: 'Components',
    pattern: 'PascalCase.astro / PascalCase.svelte',
    example: 'BlogCard.svelte',
  },
  {
    context: 'Pages',
    pattern: 'kebab-case.astro',
    example: 'tech-talks.astro',
  },
  { context: 'Utilities', pattern: 'camelCase.ts', example: 'blog.ts' },
  {
    context: 'Test files',
    pattern: '*.test.ts / *.spec.ts',
    example: 'BlogPagination.test.ts',
  },
];
---

<InternalLayout title="File Structure" description="Repository layout, key directories, and naming conventions" section="guide" subsection="file-structure">

  <!-- Repository Overview -->
  <section class="mb-12">
    <h2 class="text-xl md:text-2xl font-bold mb-4">Repository Overview</h2>
    <pre class="rounded-2xl border border-gray-200 dark:border-gray-700 p-5 text-sm overflow-x-auto bg-gray-50 dark:bg-gray-800"><code>src/
├── components/              # Reusable UI components
│   ├── BaseHead.astro       # SEO meta tags, Open Graph
│   ├── Footer.astro         # Site footer
│   ├── ThemeToggle.astro    # Dark mode toggle
│   ├── blog/                # Blog components (BlogCard, BlogGrid, Search)
│   ├── home/                # Homepage sections (Hero, Blog Preview, Projects)
│   ├── layout/              # Header.svelte, MobileMenu.svelte
│   └── pages/               # Shared page components (*Page.astro)
├── content/                 # Content Collections
│   ├── blog/en/             # English blog posts
│   ├── blog/es/             # Spanish blog posts
│   └── tags/                # Tag definitions (tech.md, personal.md)
├── integrations/            # Custom Astro integrations
├── layouts/                 # InternalLayout, ShowcaseLayout, MainLayout
├── lib/                     # Utility functions
│   ├── blog.ts              # Post fetching, pagination
│   ├── i18n.ts              # Language config, URL helpers
│   ├── constances.ts        # Site constants
│   └── translations/        # en.ts, es.ts, types.ts, index.ts
├── pages/                   # File-based routing
│   ├── index.astro          # Homepage (EN)
│   ├── es/                  # Spanish page wrappers
│   ├── blog/                # Blog routes
│   ├── internal/            # Internal Hub (dev-only)
│   │   ├── ui/              # Design System Showcase
│   │   └── guide/           # Staff Guide
│   └── api/                 # API endpoints
└── styles/
    └── global.css           # Global styles, design tokens

public/                      # Static assets
├── images/                  # Site images
│   └── blog/posts/{'{slug}'}/   # Per-post image folders
├── icons/                   # Social icons (light/dark pairs)
├── fonts/                   # Atkinson Hyperlegible
└── scripts/                 # Theme persistence</code></pre>
  </section>

  <!-- Key Directories -->
  <section class="mb-12">
    <h2 class="text-xl md:text-2xl font-bold mb-4">Key Directories</h2>
    <div class="space-y-3">
      <details class="rounded-xl border border-gray-200 dark:border-gray-700">
        <summary class="px-4 py-3 cursor-pointer text-sm font-semibold hover:bg-gray-50 dark:hover:bg-gray-800">
          src/components/
        </summary>
        <div class="px-4 pb-4 text-sm text-gray-600 dark:text-gray-300 space-y-2">
          <p><code class="text-xs">blog/</code> — BlogCard.svelte, BlogGrid.svelte, BlogPagination.svelte, StaticBlogSearch.svelte</p>
          <p><code class="text-xs">home/</code> — HeroSection/, BlogPreviewSection, ProjectsSection, and other homepage sections</p>
          <p><code class="text-xs">layout/</code> — Header.svelte (main nav, interactive), MobileMenu.svelte</p>
          <p><code class="text-xs">pages/</code> — Shared *Page.astro components (HomePage, AboutPage, ContactPage, etc.)</p>
          <p>Root files: BaseHead.astro (SEO), Footer.astro, ThemeToggle.astro</p>
        </div>
      </details>

      <details class="rounded-xl border border-gray-200 dark:border-gray-700">
        <summary class="px-4 py-3 cursor-pointer text-sm font-semibold hover:bg-gray-50 dark:hover:bg-gray-800">
          src/content/
        </summary>
        <div class="px-4 pb-4 text-sm text-gray-600 dark:text-gray-300 space-y-2">
          <p><code class="text-xs">blog/en/</code> — English posts, date-prefix naming (YYYY-MM-DD_slug.md)</p>
          <p><code class="text-xs">blog/es/</code> — Spanish posts, mirrored structure</p>
          <p><code class="text-xs">blog/{'{lang}'}/_demo/</code> — Demo posts (dev-only, never in production)</p>
          <p><code class="text-xs">tags/</code> — Tag definitions (tech.md, personal.md)</p>
          <p>Schema in <code class="text-xs">src/content.config.ts</code> — Zod validation for frontmatter</p>
        </div>
      </details>

      <details class="rounded-xl border border-gray-200 dark:border-gray-700">
        <summary class="px-4 py-3 cursor-pointer text-sm font-semibold hover:bg-gray-50 dark:hover:bg-gray-800">
          src/pages/
        </summary>
        <div class="px-4 pb-4 text-sm text-gray-600 dark:text-gray-300 space-y-2">
          <p>Root: EN page wrappers (index.astro, about.astro, contact.astro, etc.)</p>
          <p><code class="text-xs">es/</code> — Spanish page wrappers (same structure, <code class="text-xs">lang="es"</code>)</p>
          <p><code class="text-xs">blog/</code> — Blog listing, dynamic [...slug].astro, pagination, tag routes</p>
          <p><code class="text-xs">internal/</code> — Internal Hub pages (excluded from production builds)</p>
          <p><code class="text-xs">api/</code> — JSON endpoints (posts.json.ts for search)</p>
          <p>rss.xml.js — RSS feed generation</p>
        </div>
      </details>

      <details class="rounded-xl border border-gray-200 dark:border-gray-700">
        <summary class="px-4 py-3 cursor-pointer text-sm font-semibold hover:bg-gray-50 dark:hover:bg-gray-800">
          src/lib/
        </summary>
        <div class="px-4 pb-4 text-sm text-gray-600 dark:text-gray-300 space-y-2">
          <p><code class="text-xs">blog.ts</code> — getBlogPosts(), getPostSlug(), pagination utilities</p>
          <p><code class="text-xs">i18n.ts</code> — Language type, LANGUAGES registry, getUrlPrefix()</p>
          <p><code class="text-xs">translations/</code> — Modular system: en.ts, es.ts, types.ts, index.ts</p>
          <p><code class="text-xs">constances.ts</code> — SITE_TITLE, SITE_DESCRIPTION, social URLs</p>
          <p><code class="text-xs">enum.ts</code> — Shared enums</p>
          <p><code class="text-xs">types.ts</code> — TypeScript type definitions</p>
        </div>
      </details>

      <details class="rounded-xl border border-gray-200 dark:border-gray-700">
        <summary class="px-4 py-3 cursor-pointer text-sm font-semibold hover:bg-gray-50 dark:hover:bg-gray-800">
          public/
        </summary>
        <div class="px-4 pb-4 text-sm text-gray-600 dark:text-gray-300 space-y-2">
          <p><code class="text-xs">images/blog/posts/{'{slug}'}/</code> — Per-post image folders (hero.jpg, inline images)</p>
          <p><code class="text-xs">images/blog/_staging/</code> — Incoming images for optimization</p>
          <p><code class="text-xs">icons/</code> — Social icons in light/dark pairs (github.svg, github_white.svg)</p>
          <p><code class="text-xs">fonts/</code> — Atkinson Hyperlegible (Regular 400, Bold 700)</p>
          <p><code class="text-xs">scripts/global.theme.js</code> — Theme persistence (runs before DOM)</p>
          <p>Root: favicon.svg, robots.txt, llms.txt, manifest.webmanifest</p>
        </div>
      </details>
    </div>
  </section>

  <!-- Important Files -->
  <section class="mb-12">
    <h2 class="text-xl md:text-2xl font-bold mb-4">Important Files</h2>
    <div class="rounded-2xl border border-gray-200 dark:border-gray-700 overflow-hidden">
      <div class="overflow-x-auto">
        <table class="w-full text-sm">
          <thead>
            <tr class="border-b border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800">
              <th class="text-left py-3 px-4 font-semibold">File</th>
              <th class="text-left py-3 px-4 font-semibold">Purpose</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-gray-100 dark:divide-gray-800">
            {importantFiles.map((f) => (
              <tr>
                <td class="py-3 px-4"><code class="text-xs font-medium">{f.file}</code></td>
                <td class="py-3 px-4 text-gray-600 dark:text-gray-300">{f.purpose}</td>
              </tr>
            ))}
          </tbody>
        </table>
      </div>
    </div>
  </section>

  <!-- Naming Conventions -->
  <section class="mb-12">
    <h2 class="text-xl md:text-2xl font-bold mb-4">Naming Conventions</h2>
    <div class="rounded-2xl border border-gray-200 dark:border-gray-700 overflow-hidden">
      <div class="overflow-x-auto">
        <table class="w-full text-sm">
          <thead>
            <tr class="border-b border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800">
              <th class="text-left py-3 px-4 font-semibold">Context</th>
              <th class="text-left py-3 px-4 font-semibold">Pattern</th>
              <th class="text-left py-3 px-4 font-semibold">Example</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-gray-100 dark:divide-gray-800">
            {namingConventions.map((n) => (
              <tr>
                <td class="py-3 px-4 font-medium">{n.context}</td>
                <td class="py-3 px-4"><code class="text-xs">{n.pattern}</code></td>
                <td class="py-3 px-4 text-gray-600 dark:text-gray-300"><code class="text-xs">{n.example}</code></td>
              </tr>
            ))}
          </tbody>
        </table>
      </div>
    </div>
  </section>
</InternalLayout>
