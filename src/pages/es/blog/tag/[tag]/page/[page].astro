---
import BlogTagPaginationPage from '@/components/pages/blog/BlogTagPaginationPage.astro';
import { getBlogPosts } from '@/lib/blog';
import type { Language } from '@/lib/i18n';

const lang: Language = 'es';

export async function getStaticPaths() {
  const lang: Language = 'es';

  // Get all tags from all posts (not just first page)
  const allPosts = await getBlogPosts({ lang, pageSize: 9999 });
  const allTags = Array.from(
    new Set(allPosts.postsResult.flatMap((post) => post.data.tags ?? []))
  );

  const paths = [];
  for (const tag of allTags) {
    const tagPostsResult = await getBlogPosts({
      lang,
      tag,
    });
    const totalPages = tagPostsResult.totalPages;

    if (totalPages > 1) {
      for (let i = 2; i <= totalPages; i++) {
        const pagePosts = await getBlogPosts({
          lang,
          tag,
          page: i,
        });
        paths.push({
          params: { tag, page: String(i) },
          props: { blogPostsResult: pagePosts, currentTag: tag },
        });
      }
    }
  }
  return paths;
}

const { blogPostsResult, currentTag } = Astro.props;
const { tag, page } = Astro.params;
---

<BlogTagPaginationPage lang={lang} blogPostsResult={blogPostsResult} currentTag={currentTag} tag={tag} page={page} />
